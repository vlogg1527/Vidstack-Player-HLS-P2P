<!doctype html>
<html>
  <style>
    /* Reset margins, padding, and overflow for full screen and black background */
    html, body {
      margin: 0;
      padding: 0;
      overflow: hidden;
      background-color: #000; /* Black background */
      width: 100%;
      height: 100%;
    }

    .tw-video-w-full {
      width: 100%;
    }

    .tw-video-h-full {
      height: 100%;
    }

    .tw-video-overflow-hidden {
      overflow: hidden;
    }

    .tw-video-flex {
      display: flex;
      justify-content: center;
      align-items: center;
      width: 100vw;
      height: 100vh;
      background-color: #000; /* Full-screen black background */
      overflow: hidden;
      position: relative;
    }

    .play-button-container {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      opacity: 0;
      transition: opacity 0.3s;
    }

    media-player:hover .play-button-container {
      opacity: 1;
    }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/hls.js@~1/dist/hls.min.js"></script>
  <script type="importmap">
    {
      "imports": {
        "p2p-media-loader-core": "https://cdn.jsdelivr.net/npm/p2p-media-loader-core@%5E1/dist/p2p-media-loader-core.es.min.js",
        "p2p-media-loader-hlsjs": "https://cdn.jsdelivr.net/npm/p2p-media-loader-core@%5E1/dist/p2p-media-loader-core.es.min.js"
      }
    }
  </script>

  <!-- Vidstack player stylesheets -->
  <link rel="stylesheet" href="https://cdn.vidstack.io/player/theme.css" />
  <link rel="stylesheet" href="https://cdn.vidstack.io/player/video.css" />

  <!-- Vidstack player library from CDN -->
  <script src="https://cdn.vidstack.io/player" type="module"></script>

  <!-- Module script to initialize Vidstack player with P2P Media Loader -->
  <script type="module">
    import { HlsJsP2PEngine } from "p2p-media-loader-hlsjs";

    const player = document.querySelector("media-player");
    const HlsWithP2P = HlsJsP2PEngine.injectMixin(window.Hls);

    player.addEventListener("provider-change", (event) => {
      const provider = event.detail;

      if (provider?.type === "hls") {
        provider.library = HlsWithP2P;
        provider.config = {
          p2p: {
            core: { swarmId: "Optional custom swarm ID for stream" },
            segments: { forwardSegmentCount: 5000000 },
            loader: {
              cachedSegmentExpiration: 86400000,
              cachedSegmentsCount: 1000,
              requiredSegmentsPriority: 10,
              httpDownloadMaxPriority: 9,
              httpDownloadProbability: 0.06,
              httpDownloadProbabilityInterval: 1000,
              httpDownloadProbabilitySkipIfNoPeers: true,
              p2pDownloadMaxPriority: 50,
              httpFailedSegmentTimeout: 1000,
              simultaneousP2PDownloads: 20,
              simultaneousHttpDownloads: 3,
              requestTimeOut: 5000,
              trackerAnnounce: [
                "wss://tracker.streameiei.xyz",
                "wss://tracker.novage.com.ua",
                "wss://tracker.webtorrent.dev",
                "wss://tracker.openwebtorrent.com"
              ],
              rtcConfig: {
                iceServers: [
                  { urls: "stun:stun.l.google.com:19302" },
                  { urls: "stun:global.stun.twilio.com:3478" }
                ],
              },
            },
            onHlsJsCreated: (hls) => {
              hls.p2pEngine.addEventListener("onPeerConnect", (params) => {
                console.log("Peer connected:", params.peerId);
              });
            },
          },
        };
      }
    });
  </script>
</head>
<body>
  <div class="tw-video-flex">
    <media-player
      class="tw-video-w-full tw-video-h-full tw-video-overflow-hidden"
      src="https://movie.anime-av.com/hls-v2/c6557dd5fcea7d0d1db6bb259036f573/master.m3u8"
    >
      <media-provider></media-provider>
      <media-video-layout></media-video-layout>
    </media-player>
  </div>
</body>
</html>
